# ChatGPT用 セレクタ取得プロンプト

## プロンプトテンプレート

以下のプロンプトをコピーして、ChatGPTに送信してください。

---

```
以下のメルカリの商品ページから、ウェブスクレイピングに必要なセレクタ情報を取得してください。

**対象URL**: https://jp.mercari.com/item/m19494603044

**取得してほしい情報**:

1. **価格セレクタ（CSSセレクタ）**
   - 商品価格が表示されている要素のCSSセレクタを3-5個、優先順位順に列挙してください
   - 可能な限り、`data-testid`属性やID属性など、安定したセレクタを優先してください
   - 例: `[data-testid="price"]`, `div[data-testid="price"]`, `.ItemPrice__price`

2. **価格除外セレクタ（CSSセレクタ）**
   - 価格以外の数値（税額、送料など）が表示されている要素のCSSセレクタを列挙してください
   - 例: `[data-testid="tax-info"]`, `[data-testid="shipping-info"]`

3. **在庫セレクタ（CSSセレクタ）**
   - 在庫状況（売り切れなど）が表示されている要素のCSSセレクタを列挙してください
   - 在庫ありの場合は要素が存在しない可能性があるため、売り切れ時のセレクタを優先してください
   - 例: `[data-testid="sold-out"]`, `.ItemStatus__soldOut`

4. **在庫キーワード**
   - 在庫ありを示すテキスト: 例: "在庫あり", "購入手続きへ"
   - 売り切れを示すテキスト: 例: "売り切れ", "sold out", "取引中"

5. **URLパターン**
   - このサイトの商品ページURLに共通する**ドメイン部分のみ**を抽出してください
   - **重要**: パス（`/item/`など）やクエリパラメータは含めないでください
   - 例: `jp.mercari.com`, `mercari.com`
   - ❌ 誤り: `jp.mercari.com,item`（`item`はパスの一部なので不要）
   - ✅ 正解: `jp.mercari.com`

**出力形式**:
以下の表形式で出力してください。**バッククォート（`）は使用せず、そのままの文字列として出力してください。**

| 項目 | セレクタ/キーワード（カンマ区切り） |
|---|---|
| URLパターン | |
| 価格セレクタ | |
| 価格除外セレクタ | |
| 在庫セレクタ | |
| 在庫ありキーワード | |
| 売り切れキーワード | |

**出力例**:
```
| 項目 | セレクタ/キーワード（カンマ区切り） |
|---|---|
| URLパターン | jp.mercari.com,mercari.com |
| 価格セレクタ | [data-testid="price"],div[data-testid="price"] |
| 価格除外セレクタ | [data-testid="tax-info"],[data-testid="shipping-info"] |
| 在庫セレクタ | [data-testid="sold-out"],div[data-testid="sold-out"] |
| 在庫ありキーワード | 購入手続きへ,在庫あり |
| 売り切れキーワード | 売り切れ,sold out,取引中 |
```

**重要な確認事項**:
出力前に、以下の点を確認してください：
1. ✅ すべてのセレクタが標準的なCSS構文であること
2. ✅ 非標準構文（`:contains()`など）が含まれていないこと
3. ✅ URLパターンにバッククォートが含まれていないこと
4. ✅ URLパターンはドメイン部分のみで、パス（`/item/`など）を含めていないこと
5. ✅ 実際に存在するセレクタのみが列挙されていること

**注意事項（重要）**:
- **CSSセレクタは標準的な構文のみ使用してください**
  - ❌ 使用不可: `:contains()`, `:has()`, `:matches()`, `:is()`, `:where()` などの擬似クラス
  - ✅ 使用可能: `#id`, `.class`, `[attribute="value"]`, `tag`, `tag.class`, `tag#id` など
- **セレクタは複数指定する場合はカンマ区切りで列挙してください**
- **優先順位の高いセレクタを先頭に配置してください**
- **動的に生成される可能性のあるクラス名は避けてください**
  - ❌ 避ける: `.sc-33425bfe-0`, `.ItemPrice__price`（動的生成の可能性）
  - ✅ 推奨: `[data-testid="price"]`, `#itemPrice` など、安定した属性やID
- **実際に存在するセレクタのみを列挙してください**
  - 推測ではなく、実際のHTML構造を確認してからセレクタを提案してください
- **URLパターンはバッククォート（`）を含めず、カンマ区切りの文字列として出力してください**
  - ❌ 誤: `` `jp.mercari.com`, `mercari.com` ``
  - ✅ 正: `jp.mercari.com,mercari.com`
- **URLパターンはドメイン部分のみを指定してください**
  - ❌ 誤: `jp.mercari.com,item`（`item`はパスの一部なので不要）
  - ✅ 正: `jp.mercari.com`
  - 理由: URLパターンはドメイン部分でマッチングするため、パスを含めると誤検出の原因になります
```

---

## 使用例

### ステップ1: プロンプトをコピー
上記のプロンプトをコピーします。

### ステップ2: ChatGPTに送信
ChatGPTにプロンプトを送信します。

### ステップ3: 結果を確認
ChatGPTから返されたセレクタ情報を確認します。

### ステップ4: 仕入れ元マスターシートに設定
取得したセレクタ情報を「仕入れ元マスター」シートに入力します。

## プロンプトのカスタマイズ

### 他のサイト用にカスタマイズする場合

1. **URLを変更**
   ```
   **対象URL**: [調査したいサイトの商品ページURL]
   ```

2. **サイト名を追加**
   ```
   **サイト名**: [サイト名]
   **対象URL**: [URL]
   ```

3. **特定の要素に焦点を当てる**
   ```
   **特に注意してほしい点**:
   - [特定の要素や注意事項]
   ```

## プロンプトの改善案

### より詳細な情報が必要な場合

以下のセクションを追加してください：

```
**追加情報**:
- ページの読み込み方法（JavaScriptで動的に生成されるか）
- セレクタの安定性（ページ更新で変わる可能性があるか）
- 推奨される待機時間
```

### 複数の商品ページを確認したい場合

```
**確認してほしいURL**:
1. https://jp.mercari.com/item/m19494603044（在庫あり）
2. https://jp.mercari.com/item/[売り切れ商品のURL]（売り切れ）

両方のページを確認して、セレクタの違いを報告してください。
```

### セレクタの検証を強化したい場合

```
**検証方法**:
1. 各セレクタが実際に存在するか確認してください
2. セレクタが複数の要素にマッチする場合、正しい要素を特定してください
3. 動的クラス名（`sc-`で始まるクラスなど）は避けてください
4. 標準的なCSS構文のみを使用してください
```

## 検証済みのベストプラクティス

### セレクタの優先順位

1. **最優先**: `[data-testid="..."]` - 最も安定したセレクタ
2. **次点**: `#id` - ID属性（存在する場合）
3. **その他**: `[attribute="value"]` - その他の属性
4. **最後**: `.class` - クラス名（動的生成の可能性があるため注意）

### 避けるべきセレクタ

- ❌ 動的クラス名: `.sc-33425bfe-0`, `.ItemPrice__price`（CSS Modulesなど）
- ❌ 非標準構文: `:contains()`, `:has()`, `:matches()`
- ❌ 複雑なセレクタ: `section div:has(span:matches(^¥))`
- ❌ 推測に基づくセレクタ: 実際に存在しないセレクタ

### 推奨されるセレクタ形式

- ✅ `[data-testid="price"]` - 属性セレクタ（最も安定）
- ✅ `div[data-testid="price"]` - タグ + 属性セレクタ
- ✅ `#itemPrice` - IDセレクタ（存在する場合）
- ✅ `[id*="price"]` - 部分一致属性セレクタ（柔軟性あり）

## トラブルシューティング

### ChatGPTが正確なセレクタを返さない場合

1. **ページのHTMLを直接提供**
   ```
   以下のHTMLコードからセレクタを抽出してください：
   [HTMLコードを貼り付け]
   
   注意: 標準的なCSS構文のみを使用し、:contains()などの非標準構文は使用しないでください。
   ```

2. **スクリーンショットを添付**
   - ページのスクリーンショットを添付して、視覚的に確認してもらう
   - 開発者ツールで要素を選択した状態のスクリーンショットが特に有効

3. **具体的な要素を指定**
   ```
   特に以下の要素のセレクタを取得してください：
   - 価格: ¥850 と表示されている部分（data-testid属性を優先）
   - 在庫状況: 「購入手続きへ」ボタンがあるかどうか
   
   出力時は、標準的なCSS構文のみを使用してください。
   ```

4. **検証結果をフィードバック**
   ```
   前回の出力で以下の問題がありました：
   - :contains()が含まれていた → これは使用できません
   - バッククォートが含まれていた → 削除してください
   - URLパターンに`item`が含まれていた → ドメイン部分のみを指定してください（`jp.mercari.com`のみ）
   - 存在しないセレクタが含まれていた → 実際に存在するセレクタのみを出力してください
   
   これらの問題を修正して、再度出力してください。
   ```

## 出力後の確認チェックリスト

ChatGPTから出力を受け取ったら、以下の点を確認してください：

- [ ] URLパターンにバッククォート（`）が含まれていないか
- [ ] URLパターンはドメイン部分のみで、パス（`/item/`など）を含めていないか
- [ ] セレクタに非標準構文（`:contains()`, `:has()`, `:matches()`など）が含まれていないか
- [ ] すべてのセレクタが標準的なCSS構文であるか
- [ ] 動的クラス名（`sc-`で始まるなど）が含まれていないか
- [ ] `data-testid`属性が優先されているか
- [ ] 実際に存在するセレクタのみが列挙されているか

これらのチェックを通過したら、仕入れ元マスターシートに設定してください。

## 参考: 期待される出力例

### ✅ 正しい出力例

```
| 項目 | セレクタ/キーワード（カンマ区切り） |
|---|---|
| URLパターン | jp.mercari.com,mercari.com |
| 価格セレクタ | [data-testid="price"],div[data-testid="price"] |
| 価格除外セレクタ | [data-testid="tax-info"],[data-testid="shipping-info"] |
| 在庫セレクタ | [data-testid="sold-out"],div[data-testid="sold-out"] |
| 在庫ありキーワード | 購入手続きへ,在庫あり |
| 売り切れキーワード | 売り切れ,sold out,取引中 |
```

### ❌ 誤った出力例（避けるべき）

```
| 項目 | セレクタ/キーワード（カンマ区切り） |
|---|---|
| URLパターン | `jp.mercari.com`, `mercari.com` |  ← バッククォートが含まれている
| 価格セレクタ | span:contains("¥"), div:has(.price) |  ← 非標準構文が含まれている
| 在庫セレクタ | span:contains("売り切れ") |  ← 非標準構文が含まれている
```

```
| 項目 | セレクタ/キーワード（カンマ区切り） |
|---|---|
| URLパターン | jp.mercari.com,item |  ← `item`はパスの一部なので不要
| 価格セレクタ | [data-testid="price"],div[data-testid="price"] |  ← これは正しい
| 在庫セレクタ | [data-testid="sold-out"] |  ← これは正しい
```

**修正後**:
```
| 項目 | セレクタ/キーワード（カンマ区切り） |
|---|---|
| URLパターン | jp.mercari.com |  ← ドメイン部分のみ
```

## よくある間違いとその修正方法

### 1. 非標準構文の使用

**誤り**: `span:contains("売り切れ")`
**正解**: `[data-testid="sold-out"]` または 在庫キーワードで「売り切れ」を指定

**理由**: `:contains()` はCSSセレクタの標準構文ではありません。Seleniumでは使用できません。

### 2. バッククォートの使用

**誤り**: `` `jp.mercari.com`, `mercari.com` ``
**正解**: `jp.mercari.com,mercari.com`

**理由**: バッククォートはMarkdownのコードブロック用の記号です。実際の設定値には不要です。

### 3. 存在しないセレクタの列挙

**誤り**: `.ItemPrice__price`（実際には存在しない）
**正解**: `[data-testid="price"]`（実際に存在する）

**理由**: 推測ではなく、実際のHTML構造を確認してからセレクタを提案してください。

### 4. 動的クラス名の使用

**誤り**: `.sc-33425bfe-0`（動的に生成される）
**正解**: `[data-testid="price"]`（安定した属性）

**理由**: 動的に生成されるクラス名は、ページ更新で変わる可能性があります。

### 5. URLパターンにパスを含める誤り

**誤り**: `jp.mercari.com,item`（`item`はパスの一部）
**正解**: `jp.mercari.com`

**理由**: URLパターンはドメイン部分のみでマッチングします。パス（`/item/`など）を含めると、他のサイトのURL（例: `example.com/item/123`）でも誤ってマッチしてしまう可能性があります。また、システムはURLにドメイン部分が含まれているかどうかをチェックするため、ドメイン部分のみで十分です。

