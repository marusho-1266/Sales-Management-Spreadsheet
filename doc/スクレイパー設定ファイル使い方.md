# スクレイパー設定ファイル使い方

## 概要

新規追加されるショップサイトに対応するため、設定ファイル（JSON）でサイト別のセレクタを管理できるようになりました。
コードを変更せずに、設定ファイルを編集するだけで新しいサイトに対応できます。

## 設定ファイルの場所

`inventory_scraper/config/scraper_config.json`

## 設定ファイルの構造

```json
{
  "sites": [
    {
      "name": "サイト名",
      "url_patterns": ["URLに含まれる文字列"],
      "price_selectors": ["価格を取得するCSSセレクタのリスト"],
      "stock_selectors": ["在庫ステータスを取得するCSSセレクタのリスト"],
      "stock_keywords": {
        "in_stock": ["在庫ありを示すキーワード"],
        "out_of_stock": ["売り切れを示すキーワード"]
      }
    }
  ],
  "default": {
    "price_selectors": ["デフォルトの価格セレクタ"],
    "stock_selectors": ["デフォルトの在庫セレクタ"],
    "stock_keywords": {
      "in_stock": ["デフォルトの在庫ありキーワード"],
      "out_of_stock": ["デフォルトの売り切れキーワード"]
    }
  }
}
```

## 新規サイトの追加方法

### ステップ1: 商品ページのHTML構造を確認

1. ブラウザで商品ページを開く
2. 開発者ツール（F12）を開く
3. 価格が表示されている要素を右クリック→「検証」
4. 要素のCSSセレクタを確認

### ステップ2: 設定ファイルに追加

`scraper_config.json`の`sites`配列に新しい設定を追加：

```json
{
  "name": "新規ショップ名",
  "url_patterns": ["shop.example.com"],
  "price_selectors": [
    ".price",
    "#product-price",
    "[class*='price']"
  ],
  "stock_selectors": [
    ".stock-status",
    "#availability"
  ],
  "stock_keywords": {
    "in_stock": ["在庫あり", "購入可能"],
    "out_of_stock": ["売り切れ", "在庫なし"]
  }
}
```

### ステップ3: 動作確認

```bash
python main.py
```

## 楽天市場の設定例

現在の設定：

```json
{
  "name": "楽天市場",
  "url_patterns": ["rakuten.co.jp"],
  "price_selectors": [
    ".price",
    ".priceBox__price",
    "#price",
    "[class*='price']",
    "[class*='Price']",
    ".itemPrice",
    "#itemPrice"
  ],
  "stock_selectors": [
    ".stock",
    "[class*='stock']",
    "[class*='Stock']",
    ".availability",
    "#stock",
    "[class*='在庫']"
  ],
  "stock_keywords": {
    "in_stock": ["在庫あり", "在庫", "購入可能", "available"],
    "out_of_stock": ["売り切れ", "在庫なし", "完売", "sold out", "out of stock"]
  }
}
```

## セレクタの優先順位

セレクタは配列の順番で試行されます。最初に見つかったセレクタが使用されます。

```json
"price_selectors": [
  ".price",           // 1番目に試行
  "#product-price",   // 2番目に試行
  "[class*='price']"  // 3番目に試行（部分一致）
]
```

## セレクタの種類

### CSSセレクタ

- `.class-name`: クラス名で指定
- `#id-name`: IDで指定
- `[class*='price']`: 属性の部分一致
- `div.price > span`: 子要素の指定

### よく使うパターン

```json
// クラス名に"price"が含まれる要素
"[class*='price']"

// IDに"price"が含まれる要素
"[id*='price']"

// 複数のクラス名を試行
".price",
".product-price",
".item-price"
```

## トラブルシューティング

### 価格が取得できない場合

1. **セレクタが正しいか確認**
   - ブラウザの開発者ツールで要素を検証
   - セレクタが実際の要素にマッチするか確認

2. **セレクタを追加**
   - より具体的なセレクタを追加
   - 部分一致セレクタ（`[class*='price']`）を追加

3. **待機時間を確認**
   - ページの読み込みが完了する前に要素を探している可能性
   - セレクタのタイムアウト時間を確認（現在は5秒）

### 在庫ステータスが正しく取得できない場合

1. **キーワードを追加**
   - 実際のページに表示されている文字列を`stock_keywords`に追加

2. **セレクタを追加**
   - 在庫ステータスが表示されている要素のセレクタを追加

## デフォルト設定

どのサイトにもマッチしない場合、`default`設定が使用されます。
デフォルト設定は一般的なセレクタパターンを使用しているため、
多くのサイトで動作する可能性があります。

## 設定ファイルのバックアップ

設定ファイルを編集する前に、バックアップを取ることを推奨します：

```bash
cp config/scraper_config.json config/scraper_config.json.bak
```

## 設定ファイルの検証

JSON形式が正しいか確認：

```bash
python -m json.tool config/scraper_config.json
```

エラーがなければ、JSON形式は正しいです。

---

**作成日**: 2025-12-24  
**最終更新**: 2025-12-24

