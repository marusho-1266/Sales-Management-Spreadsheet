# 楽天市場のセレクタ確認方法

## 問題

楽天市場の商品ページで価格が取得できていない（`-1`が返される）場合、設定ファイルのセレクタが実際のページ構造と一致していない可能性があります。

## セレクタの確認手順

### ステップ1: 楽天の商品ページを開く

1. ブラウザで楽天の商品ページを開く
   - 例: `https://item.rakuten.co.jp/shopypp/3799-002475/`

### ステップ2: 開発者ツールを開く

1. キーボードの`F12`キーを押す（または右クリック→「検証」）
2. 「Elements」タブを選択

### ステップ3: 価格要素を特定

1. ページ上で価格が表示されている部分を右クリック
2. 「検証」を選択
3. HTML要素がハイライトされる

### ステップ4: セレクタを確認

ハイライトされた要素の属性を確認：

**例1: クラス名で指定**
```html
<span class="priceBox__price">1,980円</span>
```
→ セレクタ: `.priceBox__price`

**例2: IDで指定**
```html
<div id="itemPrice">1,980円</div>
```
→ セレクタ: `#itemPrice`

**例3: 属性で指定**
```html
<span data-testid="product-price">1,980円</span>
```
→ セレクタ: `[data-testid="product-price"]`

### ステップ5: セレクタをテスト

ブラウザのコンソール（開発者ツールの「Console」タブ）で以下を実行：

```javascript
// セレクタが正しいか確認
document.querySelector('.priceBox__price')

// 要素が見つかった場合、テキストを確認
document.querySelector('.priceBox__price').textContent
```

### ステップ6: 設定ファイルを更新

見つかったセレクタを`config/scraper_config.json`の`price_selectors`に追加：

```json
{
  "name": "楽天市場",
  "url_patterns": ["rakuten.co.jp"],
  "price_selectors": [
    ".priceBox__price",  // 実際に見つかったセレクタを先頭に追加
    ".price",
    "#price",
    // ... 他のセレクタ
  ]
}
```

## よくある楽天のセレクタパターン

### 価格セレクタ

- `.priceBox__price` - 楽天の標準的な価格表示
- `.priceBox__priceMain` - メイン価格
- `span.price` - 価格クラスを持つspan要素
- `[class*='priceBox']` - priceBoxを含むクラス名（部分一致）

### 在庫ステータスセレクタ

- `.stock` - 在庫情報
- `.availability` - 入手可能性
- `[class*='在庫']` - 「在庫」を含むクラス名

## デバッグ方法

### Pythonスクリプトでセレクタをテスト

```python
from selenium import webdriver
from selenium.webdriver.common.by import By
from selenium.webdriver.support.ui import WebDriverWait
from selenium.webdriver.support import expected_conditions as EC

browser = webdriver.Chrome()
browser.get("https://item.rakuten.co.jp/shopypp/3799-002475/")

# セレクタをテスト
selectors = [
    ".priceBox__price",
    ".price",
    "#price"
]

for selector in selectors:
    try:
        element = WebDriverWait(browser, 5).until(
            EC.presence_of_element_located((By.CSS_SELECTOR, selector))
        )
        print(f"✅ {selector}: {element.text}")
    except:
        print(f"❌ {selector}: 見つかりませんでした")

browser.quit()
```

## 設定ファイルの更新例

実際の楽天ページで確認したセレクタを追加：

```json
{
  "name": "楽天市場",
  "url_patterns": ["rakuten.co.jp"],
  "price_selectors": [
    ".priceBox__price",        // 実際に確認したセレクタ
    ".priceBox__priceMain",     // バックアップ1
    "span.price",               // バックアップ2
    "[class*='priceBox']",      // 部分一致（柔軟性）
    ".price",
    "#price"
  ]
}
```

## 注意事項

1. **セレクタの順序**: 配列の先頭から順に試行されるため、確実なセレクタを先頭に配置
2. **部分一致セレクタ**: `[class*='price']`は柔軟だが、誤検出の可能性もある
3. **複数のセレクタ**: 複数のセレクタを設定することで、ページ構造が変わっても対応可能

---

**作成日**: 2025-12-24  
**最終更新**: 2025-12-24

