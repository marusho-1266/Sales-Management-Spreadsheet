# 価格履歴自動更新のトリガー設定ガイド

## 概要
在庫管理シートの価格変更時に価格履歴を自動更新するためのトリガー設定手順です。

## 設定手順

### 1. スクリプトエディタを開く
1. Googleスプレッドシートを開く
2. メニューから「拡張機能」→「Apps Script」を選択

### 2. トリガーを作成
1. 左側のメニューから「トリガー」をクリック
2. 右下の「+ トリガーを追加」ボタンをクリック

### 3. トリガー設定
以下の設定を行います：

| 項目 | 設定値 |
|------|--------|
| 実行する関数 | `onInventorySheetEdit` |
| イベントソース | スプレッドシートから |
| イベントタイプ | 編集時 |
| エラー通知設定 | 通知する |

### 4. 権限の許可
1. 初回実行時に権限の許可が求められます
2. 「権限を確認」をクリック
3. Googleアカウントを選択
4. 「詳細」→「（プロジェクト名）に移動（安全ではありません）」をクリック
5. 「許可」をクリック

### 5. 動作確認
1. 在庫管理シートで仕入れ価格または販売価格を変更
2. 価格履歴シートで変更が反映されていることを確認

## 注意事項

### 権限について
- トリガーの作成には適切な権限が必要です
- 初回設定時は権限の許可が必要です

### 動作条件
- 在庫管理シートのG列（仕入れ価格）またはH列（販売価格）が変更された時のみ動作
- ヘッダー行（1行目）の変更では動作しません
- 商品IDが設定されていない行では動作しません

### エラーが発生した場合
1. ログを確認（「実行」→「ログを表示」）
2. 権限が正しく設定されているか確認
3. 関数名が正しいか確認

## 手動更新について
自動トリガーが設定できない場合は、以下の方法で手動更新できます：

1. カスタムメニュー「💰 価格履歴」→「手動価格履歴更新」を選択
2. 在庫管理シートの全商品の価格履歴が更新されます

## トラブルシューティング

### よくある問題

#### 1. 権限エラー
```
指定された権限では ScriptApp.getProjectTriggers を呼び出すことができません
```
**解決方法**: 手動でトリガーを設定してください（上記手順参照）

#### 2. トリガーが動作しない
**確認事項**:
- トリガーが正しく設定されているか
- 関数名が正確か
- 権限が適切に設定されているか

#### 3. 価格履歴が更新されない
**確認事項**:
- 商品IDが設定されているか
- 仕入れ価格・販売価格が数値で入力されているか
- 在庫管理シートの名前が「在庫管理」になっているか

## サポート
問題が解決しない場合は、ログの内容とエラーメッセージを確認し、システム管理者に連絡してください。

