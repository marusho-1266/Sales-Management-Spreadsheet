# 新規仕入れ元サイト追加手順書

## 概要

このドキュメントでは、スプレッドシートの「仕入れ元マスター」シートを使用して、新しい仕入れ元サイトを追加する手順を説明します。

## 前提条件

- Googleスプレッドシートの「仕入れ元マスター」シートにアクセスできること
- 追加したいサイトの商品ページにアクセスできること
- ブラウザの開発者ツール（F12キー）を使用できること

## 手順

### ステップ1: 仕入れ元マスターシートを開く

1. Googleスプレッドシートを開く
2. 「仕入れ元マスター」シートを選択

### ステップ2: 新規行を追加

1. シートの最後の行の下に新しい行を追加
2. 以下の列に情報を入力します：

| 列 | 項目名 | 説明 | 入力例 |
|---|---|---|---|
| A | サイト名 | 仕入れ元サイトの名前 | 楽天市場 |
| B | URLパターン（カンマ区切り） | サイトのURLに含まれる文字列（複数可） | rakuten.co.jp,item.rakuten.co.jp |
| C | 価格セレクタ（カンマ区切り） | 価格を取得するCSSセレクタ（優先順位順） | #itemPrice,[id*="itemPrice"],[class*="item-price"] |
| D | 価格除外セレクタ（カンマ区切り） | 除外する価格セレクタ（オプション） | [class*="special"],[class*="offer"] |
| E | 在庫セレクタ（カンマ区切り） | 在庫情報を取得するCSSセレクタ | .stock,[class*="stock"] |
| F | 在庫ありキーワード（カンマ区切り） | 在庫ありと判定するキーワード | 在庫あり,在庫,購入可能 |
| G | 売り切れキーワード（カンマ区切り） | 売り切れと判定するキーワード | 売り切れ,在庫なし,完売 |
| H | 手数料率(%) | 手数料率（数値） | 3.0 |
| I | アクセス間隔(秒) | サイト間のアクセス間隔（数値）※現在未使用 | 3 |
| J | 有効フラグ | 有効/無効 | 有効 |
| K | 備考 | 備考・メモ | 楽天ポイント考慮 |

### ステップ3: セレクタの確認方法

セレクタの確認方法は2つあります：

#### 方法A: ChatGPTを使用する（推奨）

1. `doc/ChatGPT用_セレクタ取得プロンプト.md` を開く
2. プロンプトをコピーして、対象URLを設定
3. ChatGPTに送信してセレクタ情報を取得
4. 取得した情報を仕入れ元マスターシートに入力

**メリット**: 効率的で、複数のセレクタ候補を一度に取得できる

#### 方法B: 手動で確認する

##### 3.1 価格セレクタの確認

1. 追加したいサイトの商品ページを開く
2. ブラウザの開発者ツールを開く（F12キー）
3. 価格が表示されている部分を右クリック → 「検証」を選択
4. HTML要素がハイライトされる
5. 要素の属性を確認：
   - **IDがある場合**: `#itemPrice` のように `#` + ID名
   - **クラス名がある場合**: `.price` のように `.` + クラス名
   - **属性がある場合**: `[data-testid="price"]` のように属性名と値を指定

##### 3.2 在庫セレクタの確認

1. 在庫情報が表示されている部分を右クリック → 「検証」を選択
2. HTML要素の属性を確認
3. セレクタを特定

##### 3.3 セレクタのテスト

ブラウザのコンソール（開発者ツールの「Console」タブ）で以下を実行してセレクタが正しいか確認：

```javascript
// セレクタが正しいか確認
document.querySelector('#itemPrice')

// 要素が見つかった場合、テキストを確認
document.querySelector('#itemPrice').textContent
```

### ステップ4: 設定の保存と確認

1. 入力した情報を保存
2. 「有効フラグ」列に「有効」と入力
3. 次回スクレイピング実行時に自動的に新しい設定が読み込まれます

### ステップ5: 動作確認

1. スクレイピングを実行
2. 新しいサイトのURLが正しく認識されるか確認
3. 価格と在庫情報が正しく取得できるか確認
4. 問題がある場合は、セレクタやキーワードを調整

## よくあるセレクタパターン

### 価格セレクタの例

- **ID指定**: `#itemPrice`, `#price`
- **クラス指定**: `.price`, `.item-price`
- **属性指定**: `[data-testid="price"]`
- **部分一致**: `[class*="price"]`, `[id*="price"]`

### 在庫セレクタの例

- **クラス指定**: `.stock`, `.availability`
- **ID指定**: `#stock`, `#availability`
- **部分一致**: `[class*="stock"]`, `[class*="在庫"]`

## トラブルシューティング

### 価格が取得できない場合

1. **セレクタが正しいか確認**
   - ブラウザのコンソールでセレクタをテスト
   - 複数のセレクタを試す（優先順位順に）

2. **除外セレクタを確認**
   - 価格要素が除外セレクタに該当していないか確認
   - 除外セレクタを削除または調整

3. **ページの読み込み待機**
   - JavaScriptで動的に読み込まれる場合、待機時間が必要な場合があります

### 在庫情報が取得できない場合

1. **在庫セレクタを確認**
   - 在庫情報が表示されている要素のセレクタを確認

2. **キーワードを確認**
   - 在庫あり/売り切れのキーワードが正しいか確認
   - 大文字小文字の区別に注意

### 設定が反映されない場合

1. **有効フラグを確認**
   - 「有効フラグ」列に「有効」と入力されているか確認

2. **URLパターンを確認**
   - URLパターンが正しく設定されているか確認
   - カンマ区切りで複数指定可能

3. **スクレイピングを再実行**
   - 設定変更後、スクレイピングを再実行

## 設定例

### 楽天市場の設定例

```
サイト名: 楽天市場
URLパターン: rakuten.co.jp
価格セレクタ: #itemPrice,[id*="itemPrice"],[class*="item-price"],span.priceBox__price,.priceBox__price
価格除外セレクタ: [class*="special"],[class*="offer"],[class*="card"]
在庫セレクタ: .stock,[class*="stock"],[class*="在庫"]
在庫ありキーワード: 在庫あり,在庫,購入可能,available
売り切れキーワード: 売り切れ,在庫なし,完売,sold out,out of stock
手数料率: 3.0
アクセス間隔: 3
有効フラグ: 有効
```

### メルカリの設定例

```
サイト名: メルカリ
URLパターン: mercari.com,mercari.jp
価格セレクタ: .item-price,[data-testid="price"],.merPrice
価格除外セレクタ: （空欄）
在庫セレクタ: .item-status,[data-testid="status"],.sold-out
在庫ありキーワード: 在庫あり
売り切れキーワード: 売り切れ,取引中,sold
手数料率: 10.0
アクセス間隔: 5
有効フラグ: 有効
```

## 注意事項

1. **セレクタの優先順位**
   - 価格セレクタは左から順に試行されます
   - 最初に見つかった価格が使用されます

2. **カンマ区切り**
   - 複数の値を指定する場合は、カンマ（`,`）で区切ります
   - カンマの前後にスペースを入れても構いません

3. **有効フラグ**
   - 「有効」と入力しないと設定が読み込まれません
   - 一時的に無効にしたい場合は「無効」と入力

4. **設定の反映**
   - 設定変更後、次回スクレイピング実行時に自動的に反映されます
   - 即座に反映したい場合は、スクレイピングを再実行

5. **アクセス間隔について**
   - **現在の実装**: アクセス間隔は現在未使用です。各サイトへのアクセス間には固定のランダムな待機時間（3-7秒）が使用されています。
   - **意図**: アクセス間隔は、以下の目的で将来的に実装予定です：
     - サイトごとに異なるアクセス間隔を設定できるようにする
     - サーバーへの負荷を軽減する
     - アクセス制限を回避する
     - ボット検知を回避する
   - **推奨値**: 現在は使用されていませんが、将来的な実装に備えて適切な値を設定しておくことを推奨します（例：3-5秒）

## サポート

問題が解決しない場合は、以下の情報を含めてお問い合わせください：

- サイト名
- 商品ページのURL
- 設定したセレクタ
- エラーメッセージ（あれば）

