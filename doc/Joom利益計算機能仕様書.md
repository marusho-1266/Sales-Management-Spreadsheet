# Joom利益計算機能 仕様書

## 1. 概要

### 1.1 目的
Joomでの販売における正確な利益計算と価格最適化を実現するため、DDP（Delivered Duty Paid）要件に対応した包括的な利益計算システムを構築する。

### 1.2 背景
- Joomは2021年以降、EU圏の新ルールに対応するため全配送をDDPで統一
- カテゴリー別関税率、地域別VAT率の複雑な計算が必要
- 複数の配送方法（Joom Logistics、DDP直送等）の選択とコスト比較が重要
- 在庫管理シートでの商品登録時の価格決定支援が求められる

### 1.3 対象範囲
- 在庫管理シートでの商品登録時の利益計算
- 事前の利益計算シートでの価格シミュレーション
- 複数配送業者・地域での送料比較
- DDP対応の関税・VAT込み利益計算

## 2. システム構成

### 2.1 シート構成
```
1. 利益計算シート - メインの利益計算UI
2. Joom送料マスタ - 配送業者別・地域別送料設定
3. 関税率マスタ - カテゴリー別・地域別関税率
4. VAT率マスタ - 地域別VAT率
5. 在庫管理シート - 商品登録・利益反映
6. 売上管理シート - 注文データ・利益実績
7. 価格計算設定シート - 価格計算に関する各種パラメータ設定
8. システム設定シート - Joom連携やシステム動作に関する設定
9. 為替レートシート - 為替レートの取得・管理
```

### 2.2 主要機能
- リアルタイム利益計算
- 複数配送方法の比較
- DDP料金の自動計算
- 地域別価格設定基準の提案
- 利益計算結果の在庫管理シートへの反映

## 3. データ構造

### 3.1 利益計算シート
```
行1-3: ヘッダーセクション
行4-6: 出品情報セクション
行7-25: 利益計算セクション
行26-30: 処理・オペレーションセクション
行31-35: 参考情報セクション
行36-40: DDP対応・地域別設定セクション
行41-45: 商品カテゴリー・関税設定セクション
```

#### 3.1.1 出品情報セクション
| 項目 | 列 | 説明 |
|------|-----|------|
| Joom商品SKU | B5 | 商品識別コード |
| 商品名 | E5 | 商品名称 |
| 仕入URL | B6 | 仕入れ先URL |
| 仕入元 | E6 | 仕入れ先名 |

#### 3.1.2 利益計算セクション
| 項目 | 列 | 説明 |
|------|-----|------|
| 利益額(¥) | B8 | 自動計算結果（黄色ハイライト） |
| 利益率(%) | B9 | 自動計算結果（黄色ハイライト） |
| 還付込利益額(¥) | B10 | 返金考慮後利益（黄色ハイライト） |
| 還付込利益率(%) | B11 | 返金考慮後利益率（黄色ハイライト） |
| 販売価格(¥) | B12 | 手動入力 |
| 出品数量 | E12 | 手動入力 |
| 仕入価格(¥) | B13 | 手動入力 |
| 割引率(%) | E13 | 手動入力 |
| 割引ポイント | B14 | 手動入力 |
| 仕入原価(¥) | E14 | 自動計算 |
| 重量(g) | B15 | 手動入力 |
| 発送方法 | E15 | ドロップダウン選択 |
| 配送地帯 | B16 | ドロップダウン選択 |
| 送料(¥) | E16 | 自動計算 |
| Joom手数料率(%) | B17 | 設定値（12.7%） |
| Joom手数料(¥) | E17 | 自動計算 |
| VAT率(%) | B18 | 自動取得 |
| VAT金額(¥) | E18 | 自動計算 |
| 返金額(¥) | B19 | 手動入力 |

#### 3.1.3 容積重量チェックサブセクション
| 項目 | 列 | 説明 |
|------|-----|------|
| 高さ(cm) | B20 | 手動入力 |
| 長さ(cm) | D20 | 手動入力 |
| 幅(cm) | B21 | 手動入力 |
| 容積重量(g) | D21 | 自動計算 |

#### 3.1.4 DDP対応・地域別設定セクション
| 項目 | 列 | 説明 |
|------|-----|------|
| 販売ターゲット地域 | B37 | ドロップダウン選択 |
| 推奨配送方法 | B38 | 自動表示 |
| 利用可能配送方法 | B39 | 自動表示 |
| DDP対応警告 | B40 | 自動警告表示 |

#### 3.1.5 商品カテゴリー・関税設定セクション
| 項目 | 列 | 説明 |
|------|-----|------|
| 商品カテゴリー | B42 | ドロップダウン選択 |
| 関税率(%) | B43 | 自動取得 |
| VAT率(%) | B44 | 自動取得 |
| DDP料金(¥) | B45 | 自動計算（黄色ハイライト） |

### 3.2 Joom送料マスタ
| 列 | 項目 | 説明 |
|----|------|------|
| A | 配送方法ID | 配送方法の一意識別子 |
| B | 配送方法名 | 配送業者名 |
| C | 配送タイプ | 香港倉庫/DDP直送/郵便局 |
| D | DDP対応 | TRUE/FALSE |
| E | 対応地域 | 対応可能な地域 |
| F | 重量上限(g) | 重量制限 |
| G | EU送料(¥) | EU圏送料 |
| H | ロシア送料(¥) | ロシア送料 |
| I | 東欧送料(¥) | 東欧送料 |
| J | 北米送料(¥) | 北米送料 |
| K | アジア送料(¥) | アジア送料 |
| L | オセアニア送料(¥) | オセアニア送料 |
| M | 南米送料(¥) | 南米送料 |
| N | Joom手数料率(%) | Joom手数料率 |
| O | 代行手数料(¥) | DDP直送時の代行手数料 |
| P | 関税・VAT込み | TRUE/FALSE |
| Q | 追跡可能 | TRUE/FALSE |
| R | 納期(日) | 配送日数 |
| S | 有効フラグ | TRUE/FALSE |
| T | 備考 | 備考・注意事項 |

### 3.3 関税率マスタ
| 列 | 項目 | 説明 |
|----|------|------|
| A | カテゴリーID | カテゴリーの一意識別子 |
| B | カテゴリー名 | カテゴリー名称 |
| C | 商品説明 | カテゴリーの詳細説明 |
| D | EU関税率(%) | EU圏関税率 |
| E | ロシア関税率(%) | ロシア関税率 |
| F | 東欧関税率(%) | 東欧関税率 |
| G | 北米関税率(%) | 北米関税率 |
| H | アジア関税率(%) | アジア関税率 |
| I | オセアニア関税率(%) | オセアニア関税率 |
| J | 南米関税率(%) | 南米関税率 |
| K | アフリカ関税率(%) | アフリカ関税率 |
| L | 更新日時 | データ更新日時 |
| M | 有効フラグ | TRUE/FALSE |
| N | 備考 | 備考・注意事項 |

### 3.4 VAT率マスタ
| 列 | 項目 | 説明 |
|----|------|------|
| A | 地域ID | 地域の一意識別子 |
| B | 地域名 | 地域名称 |
| C | 国名 | 国名 |
| D | VAT率(%) | VAT率 |
| E | 最低課税額(¥) | 最低課税額 |
| F | 免税額(¥) | 免税額 |
| G | 適用開始日 | 適用開始日 |
| H | 適用終了日 | 適用終了日 |
| I | 有効フラグ | TRUE/FALSE |
| J | 備考 | 備考・注意事項 |

### 3.5 価格計算設定シート
Joomでの販売における価格計算に必要な各種パラメータを一元管理するシート。

| 項目 | 列 | 説明 |
|------|-----|------|
| 最新為替レート (USD/JPY) | A | 最新の自動取得為替レート（USD/JPY）。Joomの販売価格・手数料が外貨建ての場合の円換算に使用。 |
| 出品管理為替レート (USD/JPY) | B | 出品管理時に使用する為替レート。手動設定が有効な場合に適用。 |
| 為替レート手動設定 (オン/オフ) | C | 為替レートを手動で設定するかどうかのトグル。オンの場合、出品管理為替レートが優先される。 |
| 一般関税率 (%) | D | 商品カテゴリーや地域に依存しない一般的な関税率。DDP計算のデフォルト値として使用される場合がある。**（注：詳細な関税率は「関税率マスタ」で管理）** |
| 諸費用 (%) | E | 商品固有の追加コスト（梱包材、ラベル等）の割合。 |
| 諸費用 (¥) | F | 商品固有の追加コスト（梱包材、ラベル等）の固定額。 |
| FedEx燃油サーチャージ率 (%) | G | FedEx利用時の燃油サーチャージ率。**（注：詳細な配送業者別燃油サーチャージは「Joom送料マスタ」で管理）** |
| DHL燃油サーチャージ率 (%) | H | DHL利用時の燃油サーチャージ率。**（注：詳細な配送業者別燃油サーチャージは「Joom送料マスタ」で管理）** |
| Joom手数料率 (%) | I | Joomプラットフォームに支払う手数料率。 |
| 海外販売手数料 (%) | J | Joomプラットフォーム手数料とは別に発生する海外販売に関する手数料率。 |
| Payoneer決済手数料 (%) | K | Payoneer等の決済サービスに支払う手数料率。 |
| 繁忙期追加金 (オン/オフ) | L | 繁忙期に発生する追加コストの有無。オンの場合、繁忙期追加金額が適用される。 |
| 繁忙期追加金額 (¥) | M | 繁忙期に追加される固定コスト。 |
| 更新日時 | N | 設定が最終更新された日時。 |
| 備考 | O | 設定に関するメモ。 |

### 3.6 システム設定シート
Joom連携やシステム全体の動作に関する設定を管理するシート。

| 項目 | 列 | 説明 |
|------|-----|------|
| Joom APIキー | A | Joom APIへのアクセスに必要なキー。**注：売上実績取得時のみ使用** |
| Joom API有効期限 | B | Joom APIキーの有効期限。 |
| Joomストア連携ステータス | C | Joomストアとの連携状況。 |
| システム稼働停止 (オン/オフ) | D | システム全体の自動処理を一時停止するかどうかのトグル。 |
| 前回連携時間 | E | 最後にJoom APIから注文データを取得した日時。 |
| 更新日時 | F | 設定が最終更新された日時。 |
| 備考 | G | 設定に関するメモ。 |

### 3.7 為替レートシート
GoogleFinance関数を利用した為替レートの取得・管理を行うシート。

| 項目 | 列 | 説明 |
|------|-----|------|
| 通貨ペア | A | 通貨ペア（USD/JPY, EUR/JPY等） |
| 現在レート | B | GoogleFinance関数による現在レート |
| 前日比 | C | 前日との比較 |
| 前日比% | D | 前日との比較率 |
| 更新日時 | E | 最終更新日時 |
| ステータス | F | 取得状況（正常/エラー） |
| 優先度 | G | 取得優先度（隠し列） |

## 4. 機能仕様

### 4.1 利益計算機能

#### 4.1.1 基本利益計算
```javascript
// 基本利益計算式
利益額 = 販売価格 - 仕入原価 - 送料 - Joom手数料 - VAT + 返金額
利益率 = (利益額 / 販売価格) × 100
還付込利益額 = 利益額 + 返金額
還付込利益率 = (還付込利益額 / 販売価格) × 100
```

**実行トリガー**: 
- 販売価格、仕入価格、重量、発送方法、配送地帯のいずれかのセル値を変更した時
- 商品カテゴリーを選択した時
- 「計算実行」ボタンをクリックした時

#### 4.1.2 仕入原価計算
```javascript
// 仕入原価計算式
仕入原価 = 仕入価格 × (1 - 割引率/100) - 割引ポイント
```

**実行トリガー**: 
- 仕入価格、割引率、割引ポイントのいずれかのセル値を変更した時

#### 4.1.3 送料計算
```javascript
// 送料計算ロジック
function calculateShippingCost(weight, shippingMethod, targetRegion) {
  // 1. 配送方法のDDP対応確認
  // 2. 地域別送料取得
  // 3. 重量制限チェック
  // 4. 送料計算
}
```

**実行トリガー**: 
- 重量、発送方法、配送地帯のいずれかのセル値を変更した時
- 容積重量の寸法（高さ、長さ、幅）を変更した時

#### 4.1.4 DDP料金計算
```javascript
// DDP料金計算式
関税 = 販売価格 × 関税率 / 100
VAT = (販売価格 + 関税 + 送料) × VAT率 / 100
DDP料金 = 送料 + 関税 + VAT
```

**実行トリガー**: 
- 販売価格、商品カテゴリー、配送地帯のいずれかを変更した時
- 送料が再計算された時

### 4.2 配送方法選択機能

#### 4.2.1 地域別推奨配送方法
- **EU・ロシア・東欧**: Joom Logistics推奨
- **グローバル**: eLogi DDP推奨
- **アジア中心**: eLogi DDP推奨

**実行トリガー**: 
- 販売ターゲット地域を選択した時
- 配送地帯を変更した時

#### 4.2.2 DDP対応チェック
- EU圏配送時はDDP対応配送方法のみ選択可能
- DDP非対応配送方法選択時は警告表示

**実行トリガー**: 
- 発送方法を選択した時
- 配送地帯を変更した時

#### 4.2.3 配送方法比較機能
- 複数配送方法の送料・納期・追跡可能性の比較
- 最安値配送方法の自動提案

**実行トリガー**: 
- 「配送方法比較」ボタンをクリックした時
- 重量と配送地帯の両方が入力された時

### 4.3 価格最適化機能

#### 4.3.1 目標利益率設定
- 目標利益率に基づく推奨販売価格の自動算出
- 複数利益率（15%, 20%, 25%, 30%）での価格シミュレーション

**実行トリガー**: 
- 目標利益率を変更した時
- 仕入価格、送料、各種手数料のいずれかを変更した時
- 「価格シミュレーション」ボタンをクリックした時

#### 4.3.2 地域別価格設定基準
- **EU圏**: Joom Logistics基準（倉庫までの送料 + 仕入れ + Joom手数料15%）
- **グローバル**: eLogi基準（DDP料金込み + 仕入れ + Joom手数料12.7%）

**実行トリガー**: 
- 販売ターゲット地域を変更した時
- 配送方法を変更した時

### 4.4 データ連携機能

#### 4.4.1 在庫管理シート連携
- 利益計算結果の在庫管理シートへの自動反映
- 商品選択時の基本情報自動取得

**実行トリガー**: 
- 「在庫管理シートへ反映」ボタンをクリックした時
- 商品選択モーダルで商品を選択した時
- SKUを入力した時（自動検索）

#### 4.4.2 利益計算シート連携
- 事前計算結果の在庫管理シートへの反映
- SKU検索による利益計算データの取得

**実行トリガー**: 
- 「利益計算反映」ボタンをクリックした時
- 商品登録フォームでSKUを入力した時

### 4.5 設定管理機能

#### 4.5.1 価格計算設定管理
- 為替レートの手動/自動設定切り替え
- 各種手数料率の設定・更新
- 諸費用・繁忙期追加金の管理
- 燃油サーチャージ率の設定

**実行トリガー**: 
- 設定値を変更して「保存」ボタンをクリックした時
- 設定シートのセル値を直接編集した時

#### 4.5.2 システム設定管理
- Joom APIキーの管理・更新（売上実績取得時のみ使用）
- システム稼働停止の制御
- ストア連携ステータスの監視
- 前回連携時間の管理

**実行トリガー**: 
- システム設定を変更して「保存」ボタンをクリックした時
- 定期同期処理の実行時（前回連携時間の更新）

#### 4.5.3 為替レート管理
- GoogleFinance関数による自動取得（メイン方式）
- 為替レートのキャッシュ機能（フォールバック1）
- デフォルト値によるフォールバック（フォールバック2）
- 手動更新機能

**実行トリガー**: 
- スプレッドシートを開いた時（初回読み込み時）
- 定期実行トリガー（60分間隔）
- 「為替レート更新」ボタンをクリックした時
- 為替レート手動設定がオフの状態で利益計算を実行した時

### 4.6 利益計算の2つのモード

#### 4.6.1 事前利益計算（利益計算シート）
- **目的**: 商品登録前の価格決定支援
- **データソース**: 手動入力 + マスタデータ
- **APIキー**: 不要
- **計算内容**: 推奨販売価格、予想利益率

**実行トリガー**: 
- 入力値の変更時（リアルタイム計算）
- ボタンクリック時（手動計算実行）

#### 4.6.2 事後利益計算（売上管理シート）
- **目的**: 実際の売上実績に基づく利益分析
- **データソース**: Joom API + マスタデータ
- **APIキー**: 必要（注文データ取得時）
- **計算内容**: 実際の利益額、実績利益率

**実行トリガー**: 
- 定期同期処理（60分間隔）
- 「手動同期」ボタンをクリックした時
- 特定期間の注文取得を実行した時

## 5. 計算ロジック

### 5.1 利益計算フロー

#### 5.1.1 事前利益計算フロー（利益計算シート）
```
1. 基本情報入力
   ├─ 商品情報（SKU、商品名、仕入情報）
   ├─ 価格情報（販売価格、仕入価格、割引）
   └─ 配送情報（重量、発送方法、配送地帯）

2. 配送方法検証
   ├─ DDP対応チェック
   ├─ 地域対応チェック
   └─ 重量制限チェック

3. 送料計算
   ├─ 配送方法別送料取得
   ├─ 重量・サイズ超過料金計算
   └─ 代行手数料加算

4. 関税・VAT計算
   ├─ カテゴリー別関税率取得
   ├─ 地域別VAT率取得
   └─ DDP料金計算

5. 利益計算
   ├─ 総コスト計算
   ├─ 利益額・利益率計算
   └─ 還付込利益計算

6. 結果表示・保存
   ├─ 計算結果の表示
   ├─ 推奨価格の提案
   └─ 在庫管理シートへの反映
```

#### 5.1.2 事後利益計算フロー（売上管理シート）
```
1. Joom API連携（APIキー使用）
   ├─ 注文データ取得
   ├─ 価格情報取得
   └─ 手数料・VAT情報取得

2. データ変換
   ├─ Joom形式から売上管理形式へ変換
   ├─ 通貨換算（為替レート適用）
   └─ 在庫管理シートとの連携

3. 利益計算
   ├─ 実際の売上価格
   ├─ 実際の手数料・VAT
   └─ 実績利益額・利益率計算

4. データ保存
   ├─ 売上管理シートへの保存
   ├─ 利益実績の記録
   └─ 前回連携時間の更新
```

### 5.2 為替レート取得ロジック
1. 「価格計算設定シート」の「為替レート手動設定」がオンの場合、「出品管理為替レート」を優先。
2. オフの場合、以下の優先順位で為替レートを取得:
   1. GoogleFinance関数 (`=GOOGLEFINANCE("CURRENCY:USDJPY")`など) - **メイン方式**
   2. キャッシュされた為替レート - **フォールバック1**
   3. デフォルト値（例: 150.00 JPY/USD） - **フォールバック2**
3. 取得した為替レートは「価格計算設定シート」の「最新為替レート」に反映。
4. **注意**: 外部APIは使用せず、GoogleFinance関数をメインとし、キャッシュとデフォルト値でフォールバックする設計。

**実行トリガー**: 
- スプレッドシート初回読み込み時
- 定期実行トリガー（60分間隔）
- 手動更新ボタンクリック時
- 利益計算実行時（手動設定がオフの場合）

### 5.3 エラーハンドリング

#### 5.3.1 入力値検証エラー

##### 重量制限超過時
- **対象セル**: B40（DDP対応警告セル）
- **エラーメッセージ**: 「⚠️ 重量が上限を超えています。配送方法を見直してください」
- **表示色**: 赤色（#ff4444）
- **背景色**: 薄い赤色（#ffe6e6）
- **実行条件**: 重量 > 選択された配送方法の重量上限

##### 無効な配送方法選択時
- **対象セル**: B40（DDP対応警告セル）
- **エラーメッセージ**: 「⚠️ 選択された配送方法は配送地帯に対応していません」
- **表示色**: 赤色（#ff4444）
- **背景色**: 薄い赤色（#ffe6e6）
- **実行条件**: 配送地帯と配送方法の組み合わせが無効

##### DDP非対応配送方法選択時（EU圏）
- **対象セル**: B40（DDP対応警告セル）
- **エラーメッセージ**: 「⚠️ EU圏への配送にはDDP対応配送方法が必要です」
- **表示色**: 赤色（#ff4444）
- **背景色**: 薄い赤色（#ffe6e6）
- **実行条件**: 配送地帯 = EU圏 AND DDP対応 = FALSE

##### カテゴリー未選択時
- **対象セル**: B43（関税率セル）
- **エラーメッセージ**: 「商品カテゴリーを選択してください」
- **表示色**: オレンジ色（#ff8800）
- **背景色**: 薄いオレンジ色（#fff2e6）
- **実行条件**: 商品カテゴリー = 空

##### 地域未選択時
- **対象セル**: B37（販売ターゲット地域セル）
- **エラーメッセージ**: 「配送地帯を選択してください」
- **表示色**: オレンジ色（#ff8800）
- **背景色**: 薄いオレンジ色（#fff2e6）
- **実行条件**: 配送地帯 = 空

#### 5.3.2 計算エラー

##### 数値計算エラー時
- **対象セル**: B8（利益額セル）
- **エラーメッセージ**: 「計算エラー: 入力値を確認してください」
- **表示色**: 赤色（#ff4444）
- **背景色**: 薄い赤色（#ffe6e6）
- **実行条件**: 数値計算でエラーが発生

##### 為替レート取得失敗時
- **対象セル**: I12（為替レートセル）
- **エラーメッセージ**: 「為替レート取得失敗: デフォルト値を使用」
- **表示色**: オレンジ色（#ff8800）
- **背景色**: 薄いオレンジ色（#fff2e6）
- **実行条件**: GoogleFinance関数失敗 AND キャッシュなし

#### 5.3.3 API連携エラー

##### Joom API認証エラー時
- **対象セル**: システム設定シートのC2（ストア連携ステータス）
- **エラーメッセージ**: 「認証エラー: APIキーを確認してください」
- **表示色**: 赤色（#ff4444）
- **背景色**: 薄い赤色（#ffe6e6）
- **実行条件**: HTTP 401エラー

##### レート制限超過時
- **対象セル**: システム設定シートのC2（ストア連携ステータス）
- **エラーメッセージ**: 「レート制限超過: しばらく待ってから再試行してください」
- **表示色**: オレンジ色（#ff8800）
- **背景色**: 薄いオレンジ色（#fff2e6）
- **実行条件**: HTTP 429エラー

##### ネットワークエラー時
- **対象セル**: システム設定シートのC2（ストア連携ステータス）
- **エラーメッセージ**: 「ネットワークエラー: 接続を確認してください」
- **表示色**: 赤色（#ff4444）
- **背景色**: 薄い赤色（#ffe6e6）
- **実行条件**: ネットワーク接続エラー

#### 5.3.4 データ保存エラー

##### 在庫管理シート反映失敗時
- **対象セル**: AI12（反映ステータスセル）
- **エラーメッセージ**: 「反映失敗: 在庫管理シートを確認してください」
- **表示色**: 赤色（#ff4444）
- **背景色**: 薄い赤色（#ffe6e6）
- **実行条件**: 在庫管理シートへの書き込み失敗

##### 設定保存失敗時
- **対象セル**: 各設定シートの最終列
- **エラーメッセージ**: 「設定保存失敗: 権限を確認してください」
- **表示色**: 赤色（#ff4444）
- **背景色**: 薄い赤色（#ffe6e6）
- **実行条件**: 設定シートへの書き込み失敗

#### 5.3.5 エラー表示の統一仕様

##### エラーレベル別色分け
- **重大エラー（赤色）**: 計算不能、API認証失敗、データ保存失敗
- **警告（オレンジ色）**: 重量制限超過、為替レート取得失敗、レート制限
- **情報（青色）**: 推奨事項、注意喚起

##### エラーメッセージ表示形式
```
⚠️ [エラータイプ]: [具体的な内容] - [対処方法]
例: ⚠️ 重量制限超過: 重量が上限を超えています - 配送方法を見直してください
```

##### エラー表示の持続時間
- **入力値エラー**: 入力値修正まで表示継続
- **計算エラー**: 計算成功まで表示継続
- **APIエラー**: 次回API呼び出し成功まで表示継続
- **一時的エラー**: 5秒後に自動消去

**実行トリガー**: 
- 入力値検証時（リアルタイム）
- 計算実行時
- API呼び出し時
- データ保存時

## 6. UI/UX仕様

### 6.1 レイアウト
- セクション分けによる論理的な情報整理
- 色分けによる重要項目のハイライト
- リアルタイム計算結果の表示

### 6.2 入力支援
- ドロップダウンによる選択肢の制限
- データ検証による入力値のチェック
- 自動計算による入力負荷の軽減
- トグルスイッチによる設定の切り替え

### 6.3 視覚的フィードバック
- 利益が正の場合は緑色、負の場合は赤色で表示
- 利益率による色分け（高/中/低/負）
- 警告・エラーメッセージの適切な表示
- 設定項目の有効/無効状態の視覚的表示
- 為替レートの変動状況の表示

#### 6.3.1 エラー表示の視覚的仕様
- **重大エラー**: 赤色文字（#ff4444）+ 薄い赤背景（#ffe6e6）
- **警告**: オレンジ色文字（#ff8800）+ 薄いオレンジ背景（#fff2e6）
- **情報**: 青色文字（#0066cc）+ 薄い青背景（#e6f3ff）
- **成功**: 緑色文字（#00aa00）+ 薄い緑背景（#e6ffe6）

#### 6.3.2 エラーアイコンの使用
- **⚠️**: 警告・注意事項
- **❌**: エラー・失敗
- **ℹ️**: 情報・推奨事項
- **✅**: 成功・完了

### 6.4 設定画面UI
- 価格計算設定とシステム設定の分離
- 設定項目の論理的なグループ化
- 設定値の一覧表示と直接編集
- 設定保存時の確認ダイアログ
- 設定変更履歴の表示

## 7. データ管理

### 7.1 マスタデータ管理
- 送料マスタの定期更新
- 関税率・VAT率の最新情報維持
- 配送方法の有効性管理
- 価格計算設定の定期更新
- 為替レートの自動取得・更新

**実行トリガー**: 
- マスタデータの手動編集時
- 定期更新処理（日次）
- 設定変更時

### 7.2 履歴管理
- 利益計算履歴の記録
- 価格変更履歴の追跡
- 計算結果の保存・参照
- 設定変更履歴の記録
- 為替レート取得履歴の記録

**実行トリガー**: 
- 計算実行時
- 設定変更時
- データ保存時

### 7.3 バックアップ・復旧
- マスタデータの定期バックアップ
- 計算結果の保存
- エラー時の復旧機能
- 設定データのバックアップ
- 為替レートキャッシュの管理

**実行トリガー**: 
- 定期バックアップ処理（日次）
- エラー発生時
- 手動バックアップ実行時

## 8. セキュリティ・権限

### 8.1 データ保護
- 機密情報の適切な管理
- アクセス権限の制御
- データの暗号化
- Joom APIキーの安全な管理

### 8.2 監査ログ
- 計算実行履歴の記録
- データ変更履歴の追跡
- エラーログの管理
- 設定変更履歴の記録
- API連携履歴の記録

## 9. パフォーマンス要件

### 9.1 応答時間
- 利益計算: 3秒以内
- 送料計算: 1秒以内
- データ取得: 2秒以内
- 為替レート取得: 5秒以内
- 設定更新: 1秒以内

### 9.2 同時利用
- 最大10ユーザーの同時利用
- データ整合性の維持
- 競合状態の回避
- GoogleFinance関数の制限対応

## 10. 運用要件

### 10.1 メンテナンス
- マスタデータの定期更新
- 計算ロジックの検証
- システム監視・アラート
- GoogleFinance関数の動作監視
- 設定値の妥当性チェック

### 10.2 サポート
- ユーザー操作マニュアル
- トラブルシューティングガイド
- 問い合わせ対応体制
- 設定変更手順書
- GoogleFinance関数エラー対応ガイド

## 11. 今後の拡張性

### 11.1 機能拡張
- 他ECサイト対応
- 高度な分析機能
- 自動価格調整機能
- 為替レート予測機能（GoogleFinance関数ベース）
- 設定値の自動最適化

### 11.2 データ拡張
- 新しい配送業者の追加
- 追加地域の対応
- カテゴリーの細分化
- 追加通貨ペアの対応
- より詳細な設定項目の追加

---

**作成日**: 2025年10月18日  
**バージョン**: 1.0  
**作成者**: AI Assistant  
**承認者**: [承認者名]
