# メルカリセレクタ検証結果

## 検証日
2025-12-25

## 検証URL
https://jp.mercari.com/item/m19494603044

## 検証結果

### ✅ 動作するセレクタ

#### 価格セレクタ
- `div[data-testid="price"]` ✅ **推奨**
- `[data-testid="price"]` ✅ **推奨**
- `.ItemPrice__price` ❌ 見つかりませんでした（クラス名が動的に生成される可能性）

#### 在庫セレクタ
- 在庫ありの場合、在庫セレクタは見つかりません（正常な動作）
- 売り切れの場合のみ、在庫セレクタが存在します

### ❌ 問題のあるセレクタ

1. **URLパターン**
   - ❌ `https://jp.mercari.com/item/{item_id}` - 変数 `{item_id}` は使用できません
   - ✅ `jp.mercari.com` または `mercari.com` を使用してください

2. **CSSセレクタの構文エラー**
   - ❌ `span:contains("売り切れ")` - CSSセレクタでは `:contains()` は使用できません
   - ✅ 代わりに、テキスト内容を確認するロジックを使用します

## 推奨設定

### 仕入れ元マスターシートへの設定

| 項目 | 設定値 |
|---|---|
| サイト名 | メルカリ |
| URLパターン | `jp.mercari.com,mercari.com` |
| 価格セレクタ | `[data-testid="price"],div[data-testid="price"]` |
| 価格除外セレクタ | `[data-testid="tax-info"],[data-testid="shipping-info"]` |
| 在庫セレクタ | `[data-testid="sold-out"],div[data-testid="sold-out"]` |
| 在庫ありキーワード | （空欄 - デフォルトで「在庫あり」） |
| 売り切れキーワード | `売り切れ,sold out` |
| 手数料率(%) | 10.0 |
| アクセス間隔(秒) | 5 |
| 有効フラグ | 有効 |

## 注意事項

1. **URLパターンについて**
   - URLパターンは、URLに含まれる文字列を指定します
   - 変数や正規表現は使用できません
   - 例: `jp.mercari.com` は `https://jp.mercari.com/item/m19494603044` にマッチします

2. **CSSセレクタについて**
   - CSSセレクタは標準的な構文のみ使用可能です
   - `:contains()` のような擬似クラスは使用できません
   - テキスト内容の確認は、在庫キーワードで行います

3. **動的クラス名について**
   - `.ItemPrice__price` のようなクラス名は、動的に生成される可能性があります
   - `data-testid` 属性を使用することを推奨します（より安定）

4. **在庫判定について**
   - 在庫ありの場合、在庫セレクタは存在しません
   - 売り切れの場合のみ、`[data-testid="sold-out"]` が存在します
   - 在庫セレクタが見つからない場合は「在庫あり」と判定されます

## 実装上の考慮事項

現在の実装では、在庫セレクタが見つからない場合に「在庫あり」と判定するため、メルカリの在庫判定は正常に動作します。

ただし、より確実な判定のため、以下の改善を推奨します：

1. **在庫セレクタが見つかった場合**
   - 売り切れと判定

2. **在庫セレクタが見つからない場合**
   - 在庫ありと判定（現在の実装）

この動作は、現在の実装で既に実現されています。

